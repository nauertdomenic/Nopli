<!DOCTYPE html>
<meta charset="utf-8">

<head>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
	<script>
		let url = "http://localhost:8080/projectAnimal/RestAPI/";
		let urlName = "speziesname/";
		let urlAlle = "speziesliste/";
		let items = [];
		let urlParameter = "";
		let urlLogin = "loginRest/";

		//ListRest
		$(document).ready(function() {
			$("#btnSuchen").click(function() {
				var username = $('#username').val();
				var password = $('#passwort').val();

				//Falls leer
				if(!username || !password){
					items.push("<h3>Bitte einloggen!</h3>");
					printHTML();
					return;
				}

				let authString = `${username}:${password}`

				//Service Link
				var inputParameter = $('#inputName').val();

				if (inputParameter != "") {
					urlParameter = url + urlName + inputParameter;
				} else {
					urlParameter = url + urlAlle;
				}

			let response = fetch(urlParameter, {
					method: "GET",
					headers: {
						"accept": "application/json",
						"content-type": "application/json",
						"authorization": "Basic " + btoa(username + ":" + password)
					},
				});

				console.log(response);

				response.then(function(value){
					var data = value.json();

					data.then(function(temp){

						console.log(temp);
						var count = 1;

							$.each(temp, function(key, val) {
								items.push("<h3>" + count + ". Spezies</h3>");
								console.log(val.id);
								items.push("<li>SpeziesID: " + val.id + "</li>");
								items.push("<li>Speziesname: " + val.name + "</li>");

								count = count + 1;
							});

							if(items.length < 1){
								items.push("<h3>Keine Spezies gefunden!</h3>");
							}

							printHTML();
					});
				});



			});
		});

		// //loginRest
		// $(document).ready(function() {
			// $("#btnLogin").click(function() {
		// 		var myButtonUser = document.getElementById('btnLogin');
		// 		var myBtnSuchen = document.getElementById('btnSuchen');
		// 		var myInputField = document.getElementById('inputName');
		// 		var myUsernameField = document.getElementById('username');
		// 		var myPaswordField = document.getElementById('passwort');
		//
		// 		if(myButtonUser.firstChild.data == 'Logout'){
		// 			myButtonUser.firstChild.data = 'Login';
		// 			myPaswordField.disabled = false;
		// 			myUsernameField.disabled = false;
		// 			myUsernameField.value = "";
		// 			myBtnSuchen.hidden = true;
		// 			myInputField.hidden = true;
		// 			$("#platzhalter").empty();
		// 			return;
		// 		}
		//
		// 		var username = $('#username').val();
		// 		var passwort = $('#passwort').val();
		//
		// 		if(!username || !passwort){
		// 			items.push("<h3>Bitte einloggen!</h3>");
		// 			printHTML();
		// 			return;
		// 		}
		//
		// 		var urlParameter = url + urlLogin + username + "/" + passwort;
		//
		//
		//
		// 								$(document).ready(function() {
		// 			        $.ajax({
		// 			          url: 'http://localhost:8080/projectAnimal/RestAPI/speziesliste',
		// 			          type: 'GET',
		// 			          dataType: 'json',
		// 			          beforeSend: setHeader
		// 			        });
		// 			      });
		//
		// 			      function setHeader(xhr) {
		// 			        xhr.setRequestHeader('username', username);
		// 			        xhr.setRequestHeader('password', passwort);
		// 			      }
		//
		//
		//
		// 	});
		// });

		function printHTML(){
			$("#platzhalter").empty();

			$("<ul/>", {
				"class": "my-new-list",
				html: items.join("")
			}).appendTo("#platzhalter");

			items = [];
		}
	</script>
</head>

<body>
	<div>
		<input id="username" type="text" placeholder="Username" />
		<input id="passwort" type="password" placeholder="Passwort" />
	</div>

	<br />

	<div>
		<button id="btnSuchen">Lade Spezies</button>
	</div>
	<br />
	<div>
		<input id="inputName" type="text" placeholder="Suchen mit Name" />
	</div>
	<div id="platzhalter">

	</div>
</body>